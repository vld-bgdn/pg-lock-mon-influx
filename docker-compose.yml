version: "3"
services:
  grafana:
    hostname: grafana1

  postgres:
    hostname: postgres1
  
  influxdb:
    hostname: influxdb1
    image: influxdb
    ports:
      - 8086:8086
    depends_on:
      - postgres
    environment:
      - DOCKER_INFLUXDB_INIT_MODE=setup
      - DOCKER_INFLUXDB_INIT_USERNAME=admin
      - DOCKER_INFLUXDB_INIT_PASSWORD=admins_pass
      - DOCKER_INFLUXDB_INIT_ORG=influx-org
      - DOCKER_INFLUXDB_INIT_BUCKET=influx-bucket
      - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=influx-token
      - V1_DB_NAME=influx-db
      - V1_RP_NAME=influx-rp
    volumes:
      - ./influxdb/setup-v1.sh:/docker-entrypoint-initdb.d/setup-v1.sh

  telegraf:
    hostname: telegraf1
    image: telegraf
    depends_on:
      - influxdb
    environment:
      - INFLUX_HOST=influxdb1
      - INFLUX_ADMIN_TOKEN=influx-token
      - INFLUX_ORG=influx-org
      - INFLUX_BUCKET=influx-bucket
      - POSTGRES_URI=postgres://telegraf:telegraf_password@postgres1/postgres?sslmode=disable
    volumes:
      - ./telegraf/telegraf.conf:/etc/telegraf/telegraf.conf

  app:
    hostname: app1
